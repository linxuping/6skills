var Appobj=null,App=React.createClass({displayName:"App",getInitialState:function(){return Appobj=this,{activities:[],pageable:{},age:null,area:null,loaded:!1}},updateActivities:function(){console.log("componentDidMount");var e=this.props.area;null==this.state.age?age="0-100":age=this.state.age,e=null==this.state.area?"*":this.state.area;var t={area:e,age:age,page:this.state.pageable.page||1,pagesize:10,city:"",district:"天河区",openid:geopenid()};"preview"==this.props.type&&(t.type="preview"),$.ajax({url:this.props.url,type:"get",dataType:"json",data:t,success:function(e){var t=null;t=1==e.pageable.page?e.activities:this.state.activities.concat(e.activities),this.setState({activities:t,pageable:e.pageable}),console.log("[updateActivities.]"),console.log(e.activities),console.log(this.state.activities)}.bind(this),error:function(){this.setState({activities:[]}),console.log("App error")}.bind(this)})},moreClickHandler:function(){var e=this.state.pageable;e.page+=1,this.setState({pageable:e}),this.updateActivities()},componentDidMount:function(){this.updateActivities()},render:function(){console.log("[rending.]"),console.log(this.state.activities),console.log(this.state.pageable);ges("activities/get-areas?city="+get_area());return React.createElement("div",{className:"app"},React.createElement(SelectHeader,null),React.createElement(Activities,{activities:this.state.activities,pageable:this.state.pageable,moreClick:this.moreClickHandler,type:this.props.type}))}}),SelectHeader=React.createClass({displayName:"SelectHeader",render:function(){var e=ges("activities/get-agesel");return React.createElement("div",{className:"select-header"},React.createElement(Selecter,{name:"age",text:"年龄选择",url:e}))}}),Selecter=React.createClass({displayName:"Selecter",getInitialState:function(){return{values:[],loaded:!1}},componentDidMount:function(){$.ajax({url:this.props.url,type:"get",dataType:"json",data:{},success:function(e){this.setState({values:e.values})}.bind(this),error:function(){console.log("Selecter error: "+this.props.url)}.bind(this),complete:function(){}.bind(this)}),void 0!==sessionStorage.getItem("_profile")&&null!=sessionStorage.getItem("_profile")||$.ajax({url:ges("activities/get_profile"),type:"get",dataType:"json",data:{openid:geopenid()}}).done(function(e){console.log("success"),0==e.errcode&&sessionStorage.setItem("_profile",JSON.stringify(e.profile))}.bind(this)).fail(function(){console.log("error")})},selectChanged:function(){"area"==this.props.name?Appobj.state.area=event.target.value:"age"==this.props.name&&("不限"==event.target.value?Appobj.state.age="0-100":Appobj.state.age=event.target.value),Appobj.state.pageable.page=1,Appobj.updateActivities()},render:function(){return React.createElement("div",{className:"selecter"},React.createElement("label",{forHtml:this.props.name},this.props.text,":"),React.createElement("select",{name:this.props.name,className:"weui_select ss-select",onChange:this.selectChanged},React.createElement("option",{value:"不限"},"不限"),this.state.values.map(function(e){return React.createElement("option",{value:e},e,"岁")})))}}),Activities=React.createClass({displayName:"Activities",openSignupPage:function(e,t){return 0==t&&(sessionStorage.setItem("_remains_"+e,t),location.href="/template/activity_detail.html?actid="+e),!$(event.target).hasClass("weui_btn_disabled")&&void ReactDOM.render(React.createElement(Sign,{actid:e}),document.getElementById("sign-page-wrap"))},openDetailPage:function(e,t){return"BUTTON"!=event.target.tagName&&(sessionStorage.setItem("_remains_"+e,t),void(location.href="/template/activity_detail.html?actid="+e))},render:function(){var e,t=this.props.activities&&this.props.activities.map(function(e,t){return React.createElement("li",{className:"ss-media-box",onClick:this.openDetailPage.bind(this,e.actid,e.quantities_remain)},React.createElement("div",{className:"weui_media_box weui_media_appmsg"},React.createElement("div",{className:"weui_media_hd ss-media-hd"},React.createElement("img",{className:"weui_media_appmsg_thumb",src:e.img_cover,alt:""})),React.createElement("div",{className:"weui_media_bd ss-media-bd"},React.createElement("h4",{className:"weui_media_title"},e.title),React.createElement("p",{className:"weui_media_desc"},"活动剩余名额：",e.quantities_remain,"名"),React.createElement("p",{className:"weui_media_desc"},"类型：",e.tags),React.createElement("p",{className:"weui_media_desc"},"集合地点：",e.area),React.createElement("p",{className:"weui_media_desc"},e.ages,"岁"))),React.createElement("div",{className:"ss-join-bd clearfix"},React.createElement("div",{className:"money-box fl"},"￥",e.price_child),React.createElement("button",{className:0==e.quantities_remain?"weui_btn weui_btn_mini weui_btn_default weui_btn_disabled fr":"weui_btn weui_btn_mini weui_btn_primary fr",onClick:this.openSignupPage.bind(this,e.actid,e.quantities_remain)},"preview"==this.props.type?"我要报名":"限时报名")))}.bind(this));return this.props.pageable.total>1&&this.props.pageable.total>this.props.pageable.page&&(e=React.createElement("div",{className:"more-btn",onClick:this.props.moreClick},"点击加载更多...")),React.createElement("div",{className:"activities-list weui_panel_access",id:"wrapper"},React.createElement("div",{id:"scroller"},React.createElement("ul",{className:"weui_panel_bd"},t),e,React.createElement("div",{id:"sign-page-wrap"})))}});